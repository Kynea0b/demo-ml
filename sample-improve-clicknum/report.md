# デザインの組み合わせとクリック数の関係

広告デザインの組み合わせに対して、何回クリックしたかのデータを使用して、どのデザインが最適なのかを知りたいとします。
データの性質を調べながら、モデルの妥当性を吟味しつつ、デザインの改善案を調べます。

広告デザインはいくつかの組み合わせでディスプレイに表示されます。
今回はd1からd12までの広告デザインがあるとします。

data

```csv
d1,d2,d3,d4,d5,d6,d7,d8,d9,d10,d11,d12,click
0,1,1,1,0,1,0,1,0,1,0,1,175
```

- 説明変数;
  表示される:1 表示されない:0
- 目的変数;
  クリック回数

今回は、ポアソン回帰と負の二項回帰、SVMで調べます。

# 一般化線形モデル

## ポアソン回帰

クリック数は、典型的なカウントデータです。このため、セオリー通り、ポアソン回帰で分析してみます。

交互作用を気にせず、各変数 $`\{ d_1,d_2, \cdots , d_{12} \}`$ は独立であると仮定し、ステップワイズ法を使用して、説明変数を選択して性能を見てみます。
Estimateが正の値はクリック数増、負の値はクリック数減に寄与しているとみることができます。
従って、以下のモデル性能の出力からはデザイン要素とクリック数の関係について次のことが結果が言えそうです。

- クリック数増: $`\{d_1, d_3, d_9\}`$
- クリック数減: $`\{d_2, d_{10}\}`$

```
> summary(step.p_model)

Call:
glm(formula = click ~ d1 + d2 + d3 + d5 + d6 + d7 + d8 + d9 + 
    d10 + d11 + d12, family = poisson, data = dat1)

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.413185   0.020914 306.643  < 2e-16 ***
d1           0.736299   0.011281  65.271  < 2e-16 ***
d2          -0.120217   0.009867 -12.183  < 2e-16 ***
d3           0.200392   0.009528  21.032  < 2e-16 ***
d5          -0.059299   0.009187  -6.455 1.08e-10 ***
d6           0.224234   0.010039  22.336  < 2e-16 ***
d7           0.049432   0.008782   5.629 1.81e-08 ***
d8          -0.016869   0.008549  -1.973   0.0485 *  
d9           0.247561   0.011240  22.026  < 2e-16 ***
d10         -0.189420   0.009656 -19.616  < 2e-16 ***
d11         -0.078933   0.009865  -8.002 1.23e-15 ***
d12         -0.087681   0.008344 -10.509  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 21668.7  on 69  degrees of freedom
Residual deviance:  8720.6  on 58  degrees of freedom
AIC: 9348.9
```

ここで、平均と分散を調べてみます。データの性質として、平均と分散が同じ程度の時、ポアソン回帰に適したデータです。

目的変数である、click列の平均と分散を調べます。

```
> mean(dat1[,13])
[1] 1067.5
> var(dat1[,13])
[1] 309571.6
```

平均値が、`1067.5`、分散値が`309571.6`で、分散値が平均値に比べて大幅に大きいことがわかります。
ですから、この場合は、負の二項分布を使用して、回帰分析した方が良さそうです。

## 負の二項回帰

下記の結果からは、残差逸脱度は`71.921`です。ポアソン回帰の結果は`8720.6`ですので、負の二項回帰の方がモデルの当てはまりが良いことがわかります。
クリック数の増減に寄与するデザイン要素は下記のようです。絶対値が|0.1|よりも大きいものを大きい順に並べています。デザイン要素は比較的、ポアソン回帰と似た要素が抽出されました。

- クリック数増: $`\{d_1, d_3, d_9\}`$
- クリック数減: $`\{d_2,d_{6},d_{7},d_{10}\}`$

```
> summary(nb_model)

Call:
glm.nb(formula = click ~ ., data = dat1, init.theta = 6.40747075, 
    link = log)

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  6.48958    0.29452  22.035  < 2e-16 ***
d1           0.71567    0.14919   4.797  1.2e-05 ***
d2          -0.15583    0.15249  -1.022   0.3112    
d3           0.23391    0.12681   1.845   0.0703 .  
d4          -0.05671    0.11721  -0.484   0.6304    
d5          -0.04942    0.13546  -0.365   0.7166    
d6           0.15940    0.15257   1.045   0.3006    
d7           0.11804    0.12263   0.963   0.3398    
d8          -0.08133    0.12886  -0.631   0.5304    
d9           0.19946    0.15403   1.295   0.2006    
d10         -0.18792    0.13613  -1.380   0.1728    
d11         -0.08563    0.13915  -0.615   0.5407    
d12         -0.07408    0.12333  -0.601   0.5504    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for Negative Binomial(6.4075) family taken to be 1.262109)

    Null deviance: 158.029  on 69  degrees of freedom
Residual deviance:  71.921  on 57  degrees of freedom
AIC: 1052.4

Number of Fisher Scoring iterations: 1
```

### ポアソン回帰 vs 負の二項回帰

比較には、残差のプロットをするかまたは尤度比検定を行います。

残差をプロットして、ポアソン回帰と負の二項回帰を比較すると、ポアソン回帰でより残差が広がっていることがわかります。
<img src="https://github.com/user-attachments/assets/9ed56f0d-b531-4624-ba0f-4ebf2814cdfc" width="400">
<img src="https://github.com/user-attachments/assets/75b275bd-7e3b-4693-b916-162e42dc959a" width="400">

### 尤度比検定

また、クリック数の増減に与える説明変数の結果を見ると、ポアソン回帰と負の二項回帰では一部重複が見られたため、尤度比検定を行なってみます。

```
> lrtest(nb_model, p_model)
Likelihood ratio test

Model 1: click ~ d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9 + d10 + d11 + 
    d12
Model 2: click ~ d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9 + d10 + d11 + 
    d12
  #Df  LogLik Df  Chisq Pr(>Chisq)    
1  13  -513.2                         
2  13 -4662.3  0 8298.3  < 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
```

p = 2.2e-16 << 0.05
より、負の二項回帰が大幅にモデルとして性能が良さそうです。

## ランダムフォレスト回帰

$`\{d_1, d_3, d_9\}`$
$`\{d_2, d_6, d_7, d_10\}`$

```
Call:
 randomForest(formula = click ~ ., data = dat1, ntree = 4000) 
               Type of random forest: regression
                     Number of trees: 4000
No. of variables tried at each split: 4

          Mean of squared residuals: 183066.1
                    % Var explained: 40.01
```

クリック数の増減に関わるデザイン要素を大きい順に並べてプロットした図です。
負の二項回帰でクリックの増減に関わる説明変数を抽出しました。これと合わせて考えると、$`\{d_1, d_9\}`$ はクリック増に寄与していそうです。
また、クリック減につながる $`\{d_2, d_6, d_7, d_10\}`$ が比較的上位に位置していることから、デザインは改善が必要そうです。

<img src="https://github.com/user-attachments/assets/467db52b-a14c-409a-8e2a-84b7a3dc5997" width="400">


## SVR



todo write
